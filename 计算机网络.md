计算机网络解决了【信息如何从源传递到目的地？】这一问题。



# 基本概念

### 比特

有两个概念：

- 信息量的单位，二进制数的一位所包含的信息就是一比特。如1101就是4比特。
- 数据存储的最小单位，二进制数系统中，每个0或1就是一个位（比特），8比特称为一个字节。
  - 计算机中的cpu位数指的是cpu一次能处理的最大位数，例如32位计算机的cpu一次最多能处理32位数据。

### 比特时间

发送一比特需要的时间

### 信道

信号在通信系统中传输的通道，由信号从发射端传输到接收端说经过的传输媒质所构成。

### 拓扑

即信道（信号通道）的分布方式。常见的

- 总线拓扑
  - 所有主机挂载在总线上，从主机上发出的信号在总线上双向同时传输、所有主机都可以接受到这个信号
- 星形拓扑
  - 所有主机都挂载在一个中心节点上，这个中心节点一般由交换机充当
- ...

### 协议

一系列规则和约定的规范性描述，用来控制网络中的设备之间如何交换信息

### 数据帧



### 数字带宽

单位时间内流经的信息量，基本单位为比特/秒（bps），通常用kbps（1000bps）、Mbps(10^6 bps)

### 吞吐量

实际上可测出来的带宽，受网络设备性能、时间、用户数量、网络拓扑、服务器、用户计算机性能等多个因素影响，直接影响用户体验, 常用单位也是Kbps, Mbps。

### 时延

从发送方开始发送数据算起，到接收方完全接收这个数据的时间间隔。

### 点到点、端到端

点到点：机器之间的直接连接，例如家里面的电脑和电信局的设备之间的连接

端到端：是一个虚连接，它是由一系列点到点连接组成的

### 计算机网络的分类

根据是否有线：有线网络 / 无线网络

根据覆盖范围：PAN -> 局域网（覆盖范围1公里左右）-> LAN -> MAN -> (互联网)WAN（覆盖全球）



# 分层模型

### OSI 7层模型（没有流行起来）

**每一层都利用下层提供的服务来为上层提供服务**

- 应用层
  - 为各种网络应用提供服务
- 表示层
  - 将数据表示成机器认识的比特流
- 会话层
  - 协调通信双方的会话
- 传输层
  - 负责通信主机之间的端到端的连接
- 网络层
  - 负责将每一个分组从源机一路送到目的机
  - 地址
  - 最优路径：路由，用来做寻路径
- 数据链路层
  - 提供介质访问服务
- 物理层
  - 提供透明的比特流传递，不关心比特流携带的信息含义

### TCP/IP 4层模型

### 服务、协议和接口之间的关系

参考模型的每一层都为它的上层提供服务，以接口的形式供上层调用，协议作用于对应层之间

层与层之间有接口，用于服务的调用。

# 物理层

#### 理想信道（无噪声信道）

#### 有噪声信道

#### 同轴电缆

#### 复用技术

让多个用户共享同一信道（主线）的方式，因此复用技术是用在干线上的技术，它要解决的是**干线起点如何共用、干线终点如何分离**的问题

- 频分多路复用 FDM
  - 原理：在干线起点，信道的**频谱**被分成若干**频段**（子带），每个用户占据一段来传输自己的信号；在干线的终点，每个子带的信号被单独分离出来给各个用户。
- 波分多路复用 WDM
  - ​	原理：本质跟FDM一样，在干线起点，根据不同的波长将干线分成若干份，承载不同用户的光信号。
- 时分多路复用TDM
  - 原理：在时间上共享信道，将**时间**划分为非常短的时间片，每个用户周期性地在自己的时间片内使用整个带宽。

- 码分多路复用 CDMA
  - 原理：可以看成每对交谈者用不同的语言，讲中文的只听见中文，其他语言对他来说就是噪声。FDM需要在频率上分离信号、TDM需要在时间上分离信号，而CDMA既能共享信道的所有频率又能共享时间，是一种真正的动态复用技术。

#### 调制技术

调制技术是一种将信源产生的信号转换为适宜无线传输的形式的过程。它将模拟信号抽样量化后，以二进制数字信号“1”或“0”对载波进行通断调制，并进行脉冲编码（PCM）。

- 基本概念
  - 载波：未被调制的高频电震荡称为载波，可以是正弦波或非正弦波（方波、脉冲序列等）
  - 调制信号：用来控制载波的参数（振幅、相位、频率），使载波的振幅、相位、频率变化的基带信号称为调制信号。基带信号是原始的电信号。
  - 已调波：被调制信号调制过的高频电震荡称为已调波/已调信号。

- 模拟调制

  - 一般指调制信号和载波都是连续波的调制方式。

- 数字调制

  - 载波是连续波，但是调制信号是离散的。

  

##### 基带传输

信号的传输占据了传输介质从0到最大值之间的全部频率。这是有线介质普遍采用的方法。如以太网。

- 直接将数据比特转换为信号，比如用高电压表示1，低电压表示0；或用电压调变表示1，无跳变表示0. 这就是线路编码(line codes)

##### 通带传输

通过调节信号的振幅、相位或频率来传输比特。信号只占据以载波频率为中心的一段频带。

#### 公共交换电话网络PSTN

PSTN的任务：传递人类的语音

- 脉冲编码调制PCM：是一种将模拟信号数字化的技术 ，是现代PSTN 的核心。

##### 电路交换

提前分配：数据传输之前必须建立一条端到端的通路

顺序到达：数据沿着通道按顺序到达，数据传输完成后拆除连接。

##### 包/分组交换

按需分配：每个包携带目的地址等信息，独立寻径。

可能乱序到达。

容错能力更强：当中间交换设备瘫痪，包可绕道而行。

#### 物理层设备

被动设备：接线板、插座、插头、电缆

主动设备：转发器、中继器、集线器



# 数据链路层

错误：

- 单个错误
- 突发错误

错误处理：

- 纠错
- 检错

海明距离

- 度量了两个码字之间的不同位数。
- 决定了能够纠错或检错的位数，一个系统中合法码字之间的海明距离d越大，这个系统能够纠错的位数n就越多，满足d=2n+1的关系。

### 纠1位错的海明码

可以纠单一错误 或 突发错误

### 基本数据链路协议



##### 单工协议

- 协议1:单工协议

  - 发送方：不断从网络层拿数据并封装成帧发送给物理层

  - 收方：不断从物理层收帧，一旦收到就立马解封装并发送给网络层



- 协议2:半双工协议，增加了接收方向发送方的反馈
  - 发送方：一旦组装好帧发送给物理层后，就等待接收方发送一个反馈，一旦接受到反馈后才会继续从网络层拿数据封装发送
  - 接收方：一旦接受到物理层过来的帧之后，会给发送方发送一个反馈之后，然后才会继续接受下一个帧



- 协议3: 增加了对正确帧的确认
  - 接收方：发送方向接收方发送一个数据后，就启动定时，接收方需要在定时器结束之前向发送方发送一个数据确认信号
  - 发送方：如果发送方在定时器结束之前没有收到信号，那么发送方会重发当前数据包



##### 全双工协议

- 发方既可以发数据，也可以收数据，收方也是。

- 捎带确认：收方对自己收到的帧进行确认的时候，不需要单独发一个确认帧，而是可以把确认字符放到自己要发给对方的数据中，捎带过去，提高了信道的利用率。
  - 关键：找到一个便车可以捎带上自己的确认
  - ACK (Acknowledge character）即是确认字符，在数据通信中，接收方发给发送方的一种传输类[控制字符](https://baike.baidu.com/item/控制字符/6913704)。表示发来的数据已确认接收无误。

##### 协议4: 滑动窗口协议

滑动窗口技术可以批量收发数据，提高了信道利用率。

- 发送窗口：对应着已经发送但还未被确认的帧
  - 滑动条件：收到了帧的确认
- 接收窗口：对应着期待接收的帧
  - 滑动条件：收到了期待接收的帧
- 窗口数的计算跟带宽-延迟积正相关

- 信道容量：一帧从发出到目的期间，信道上能够容纳的帧数量，记为b

- 传输时延：用L比特表示分组的长度，用R bps表示链路传输速率。则传输时延为L/R。这是路由器将分组推送出链路的耗时。实际的传输时延通常在毫秒到微秒级。

- 传播时延：一旦一个比特被推向链路，该比特需要向路由器B传播，从该链路的起点到路由器B的传播所需要的时间是传播时延。传播时延等于两台路由器之间的距离除以传播速率，传播时延在毫秒级。

> 根据计算机网络·自顶向下方法（第六版）的解释，传播时延是汽车在高速上跑的时间，传输时延是汽车通过收费站的时间。

设数据帧的长度为k，信道传输速率为b bps，来回时间为R sec，则信道利用率为 传输时延 / （传输时延 + 传播时延）= k/(k + bR) = (k/b) / ((k / b) + R)

当滑动窗口长度为W时，信道利用率-> W*k/(k + bR)，因此增加滑动窗口最大长度W可以提高信道利用率。

##### 协议5: 回退n帧：重传出错帧后面的所有帧

特点：发送方需要较大的缓冲区，适用于出错率较小的网络环境

- 发送方：
  - 正常发送
    - 对帧编号，缓存所有未被确认的帧
  - 收到确认
    - 释放确认帧所占的缓冲区，滑动发送窗口
  - 差错帧确认超时
    - 回退到出错帧，顺序重传**最后被确认的帧**以后的缓冲区中缓存的**所有帧**
- 接收方：
  - 接收窗口为1
  - 收到每一个期望的正确帧时：
    - 上交网络层，回发确认(ack)
  - 收到差错帧：
    - 丢弃，**并回发对接收的最后确认帧的确认**

##### 协议6: 选择性重传：只重传出错的那一帧

特点：接收方需要较大的缓冲区，适应于出错率较大的网络环境

- 发送方：
  - 正常发送
    - 对帧编号，缓存所有未被确认的帧
  - 收到确认
    - 释放确认帧所占的缓冲区，滑动发送窗口
  - 差错帧确认超时
    - **重传差错帧**
- 接收方：
  - 接收窗口为滑动窗口
  - 收到每一个期望的正确帧时：
    - 上交网络层，回发确认(ack)，滑动接收窗口
  - 收到差错帧：
    - 缓存差错帧后面的非差错帧，**并回发对接收的最后确认帧的确认**
  - 收到重传帧：
    - 将缓存的帧与重传帧**合并到一起排序上交**，回发确认，滑动接收窗口

## 介质访问控制子层

- 单播：一对一通信
- 广播：一对多，需要多路信道，需要多个站点同时请求某一个信道，涉及到信道的分配问题，这就是介质访问控制需要解决的问题：某个时刻由哪个工作站共享信道？
  - 静态分配：预先分配给各用户
  - 动态分配：信道是开放的，按需临时动态分配给用户
- 组播
- 局域网中主要采用在共享信道上的广播

#### ALOHA协议

#### CSMA协议

- 先听后发，边发边听

#### 以太网

- 以太网是多路访问协议CSMA/CD的实现，采用了二进制指数回退算法，降低了再次冲突的可能性；

- 以太网位于OSI模型的下两层：物理层和数据链路层

- 以太网采用曼彻斯特编码，低电压变到高电压表示0，高电压变到低电压表示1

半双工->全双工, 降低比特时间，

帧格式、接口

##### 以太网帧格式

- 前导码：用来表示帧起始的标志
- 目的地址
  - 目的工作站的mac地址，48位地址空间，分成前24位（OUI，表示一个机构）
- 源地址
  - 源工作站的物理地址（MAC），mac地址由48位组成，MAC地址不可更改，全球唯一
- 类型：表示上层使用的协议
- 数据字段：长度为46～1500个字节
- 校验和：4个字节表示，采用的是CRC循环冗余校验

##### 二层交换

- 网桥/交换机可以将采用不同协议的局域网（LAN）连接起来。网桥工作在数据链路层，通过检查mac地址作出转发帧的决策，**网桥不会检查网络层，因此不管是采用ipv4/6等协议的分组都可以穿越网桥**。

- 交换机是网桥的现代名称，二层交换机属于数据链路层设备，可以识别数据帧中的MAC地址信息，根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在自己内部的一个地址表中。

二层交换的过程：

- 当一个帧到达网桥的某个端口时，它从帧里读取出源mac地址和目的mac地址，并在地址表中查找相应的端口，如果表中有与目的mac地址相对应的端口则把数据帧直接发到这个端口上，如果表中没有找到，则把数据帧广播到所有端口上，如果目的机器做出了回应，交换机就学到了这一目的mac地址与哪个端口对应，下次往这个目的mac地址传数据时就不需要对所有端口进行广播了。

- 不断的循环这个过程，对于全网的MAC地址信息都可以学习到，二层交换机就是这样建立和维护它自己的地址表。



